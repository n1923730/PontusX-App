"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.getAccessDetails = void 0;
const lib_1 = require("@oceanprotocol/lib");
const subgraph_1 = require("../subgraph");
const TokenPriceQuery_gql_1 = require("../subgraph/TokenPriceQuery.gql");
async function getAccessDetails(subgraphUri, datatokenAddress, timeout, account = '') {
    try {
        const queryContext = (0, subgraph_1.getQueryContext)(subgraphUri);
        const tokenQueryResult = await (0, subgraph_1.fetchData)(subgraphUri, TokenPriceQuery_gql_1.tokenPriceQuery, {
            datatokenId: datatokenAddress.toLowerCase(),
            account: account?.toLowerCase()
        }, queryContext);
        const tokenPrice = tokenQueryResult.data.token;
        const accessDetails = (0, subgraph_1.getAccessDetailsFromTokenPrice)(tokenPrice, timeout);
        return accessDetails;
    }
    catch (error) {
        lib_1.LoggerInstance.error('Error getting access details: ', error.message);
    }
}
exports.getAccessDetails = getAccessDetails;
//# sourceMappingURL=access-details.js.map